<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>무중단 배포 환경 이해</title>

  <!-- CSS -->
  <link rel="stylesheet" href="/assets/css/main.css" type="text/css">

  <!-- Font -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
  <link href='//spoqa.github.io/spoqa-han-sans/css/SpoqaHanSans-kr.css' rel='stylesheet' type='text/css'>
  <link href="https://fonts.googleapis.com/css?family=Ubuntu+Mono" rel="stylesheet">

  <link rel="alternate" type="application/rss+xml" title="RSS Feed for Hyerin Blog" href="/feed.xml" />
  <!-- Begin Jekyll SEO tag v2.7.1 -->
<title>무중단 배포 환경 이해 | Hyerin Blog</title>
<meta name="generator" content="Jekyll v3.9.0" />
<meta property="og:title" content="무중단 배포 환경 이해" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="로드밸런싱, 롤링, 카나리, 블루 그린" />
<meta property="og:description" content="로드밸런싱, 롤링, 카나리, 블루 그린" />
<link rel="canonical" href="http://localhost:4000/2021-10-17/deploy/" />
<meta property="og:url" content="http://localhost:4000/2021-10-17/deploy/" />
<meta property="og:site_name" content="Hyerin Blog" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-10-17T00:00:00+09:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="무중단 배포 환경 이해" />
<script type="application/ld+json">
{"url":"http://localhost:4000/2021-10-17/deploy/","headline":"무중단 배포 환경 이해","dateModified":"2021-10-17T00:00:00+09:00","datePublished":"2021-10-17T00:00:00+09:00","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/2021-10-17/deploy/"},"@type":"BlogPosting","description":"로드밸런싱, 롤링, 카나리, 블루 그린","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->


  <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-8RJ9ZZ1LSQ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-8RJ9ZZ1LSQ', { 'anonymize_ip': false});
</script>


</head>

<body>
  <div class="content-container">
    <header>
  <div class="header-small">
    <a href="http://localhost:4000">Hyerin Blog</a>
  </div>
</header>
<div class="post">
  <div class="post-title">무중단 배포 환경 이해</div>
  <br />
  <span class="post-date">
    <time>17 Oct 2021</time>
  </span>

  <div class="post-tag">
    <ul>
      
      <li>
        <a href="http://localhost:4000/tags#infra">
          <span>infra</span>
        </a>
      </li>
      
      
    </ul>
  </div>

  <p><br /></p>

<h2 id="무중단-배포란">무중단 배포란?</h2>

<p>무중단 배포란 배포를 중단 없이 진행한다는 의미다.</p>

<blockquote>
  <p>배포란 개발환경에서 개발된 코드를 패키징하여</p>

  <p>서버에서 새로운 버전의 애플리케이션을 실행하도록 하는 것을 의미한다.</p>
</blockquote>

<p><br /></p>

<p><img src="https://user-images.githubusercontent.com/33855307/137627040-7f68f250-bec2-4d84-bb34-348df1bd37c1.jpeg" alt="무중단배포" /></p>

<p><br /></p>

<p>이전 버전 애플리케이션을 종료시키고 새로운 버전 애플리케이션을 실행하고 새로운 버전 애플리케이션이 요청을 받을 준비가 될 때까지 서비스가 중단된다.</p>

<p>서비스가 중단되는 시간을 다운타임이라고 한다.</p>

<p><br /></p>

<p>Q. 새로운 버전의 애플리케이션을 배포하기 전에 예전 버전의 <strong>애플리케이션을 중단시키는 이유는?</strong></p>

<p>A. 같은 포트를 사용하기 때문이다.</p>

<p>하나의 서버에서 하나의 포트를 동시에 서로 다른 애플리케이션이 사용하는 것은 불가능하다.</p>

<p><br /></p>

<p>Q. 그렇다면 <strong>서버를 두 개로 늘리면</strong> 어떻게 될까?</p>

<p>A. 서버가 두 개가 되면 사용자는 <strong>두 서버 모두의 IP 혹은 도메인 주소를 알아야 한다.</strong></p>

<p>그리고 두 서버중 어떤 서버가 배포되고 있는지 알 방법이 없다.</p>

<p><br /></p>

<p>그렇다면 결론은 <strong>애플리케이션 서버와 사용자 사이에 중계 해줄 서버가 필요하다.</strong></p>

<p><br />
<br /></p>

<h2 id="리버스-프록시">리버스 프록시</h2>

<p><img src="https://user-images.githubusercontent.com/33855307/137628085-3f76827e-150d-481a-8ac3-370704719a4e.jpeg" alt="ㅁ" /></p>

<p><br /></p>

<p>위 그림에서 애플리케이션 서버와 사용자 사이에서 요청을 중계해주는 서버를</p>

<p><strong>리버스 프록시(reverse proxy)</strong> 라고 한다.</p>

<p><br /></p>

<p>클라이언트는 애플리케이션 서버를 모르기 때문에</p>

<p>리버스 프록시로 서버를 분산하면서 트래픽도 분산할 수 있게 되었다.</p>

<p>이렇게 트래픽을 분산하여 각 서버가 받는 부하를 분산하는 것을 <strong>로드밸런싱(Load balancing)</strong> 이라고 한다.</p>

<blockquote>
  <p>로드밸런싱에 대해서는 다음 게시글에서 자세히 알아보고</p>

  <p>우선 여러가지 배포 방식에 대해 알아보자.</p>
</blockquote>

<p><br />
<br /></p>

<h2 id="배포-방식">배포 방식</h2>

<h4 id="1-롤링-rolling">1) 롤링 (Rolling)</h4>

<p>일반적인 배포 방식이다.</p>

<p>이전 버전에서 새로운 버전으로 트래픽을 점진적으로 전환하는 배포 방식으로</p>

<p>관리가 편하지만 배포 중 한쪽 인스턴스의 수가 감소되므로 서버 처리 용량을 미리 고려해야 한다.</p>

<p><br />
<br /></p>

<h4 id="2-블루-그린-blue-green">2) 블루 그린 (Blue Green)</h4>

<p>이전 버전을 블루, 새로운 버전을 그린이라고 한다.</p>

<p>새로운 버전을 배포하고 한번에 전환하여 모든 연결을 새로운 버전으로 바라보게 하는 전략이다.</p>

<p>동시에 나란히 구성하여 배포 시점에 트래픽이 일제히 전환된다.</p>

<p>빠른 롤백이 가능하고 운영환경에 영향을 주지 않고</p>

<p>실제 서비스 환경으로 테스트가 가능하다.</p>

<p>단 시스템 자원이 두배로 필요하기 때문에 비용이 많이 발생한다.</p>

<p><br />
<br /></p>

<h4 id="3-카나리-canary">3) 카나리 (Canary)</h4>

<p>지정한 서버 또는 특정 유저에게만 배포했다가 정상적이면 전체를 배포한다.</p>

<p>서버의 트래픽 일부를 새로운 버전으로 분산하여 오류 여부를 확인할 수 있다.</p>

<p>이런 전략은 A/B 테스트가 가능하며, 성능 모니터링에 유용하다.</p>

<p>트래픽을 분산시킬 때는 라우팅을 랜덤 하게 할 수 있고</p>

<p>사용자로 분류할 수도 있다.</p>

<p><br />
<br /></p>

<h2 id="트래픽이-많아지면">트래픽이 많아지면?</h2>

<p>트래픽이 많아지면 위에서 본 로드밸런싱만으로 충분하지 않다.</p>

<p>결국 서버 자원을 사용해서 동작하는 애플리케이션이기 때문에 다음과 같은 방법도 고려해봐야 한다.</p>

<ul>
  <li>
    <p>Nginx(로드밸런싱)이 실행되는 서버 Scale-up</p>
  </li>
  <li>
    <p>네트워크 장치로 로드 밸런싱 - 하드웨어</p>
  </li>
  <li>
    <p>DNS 리다이렉션 - 로드밸런싱을 여러개 두는 방식</p>
  </li>
</ul>

<p><br /></p>

<p>위 방법 외에도 여러 방법이 있겠지만</p>

<p>중요한 것은 어떤 부분이 병목인지 확인하는 것이다.</p>

<p><br />
<br /></p>

<h3 id="참고">참고</h3>

<ul>
  <li><a href="https://www.lesstif.com/system-admin/forward-proxy-reverse-proxy-21430345.html">포워드 프록시(forward proxy) 리버스 프록시(reverse proxy) 의 차이</a></li>
  <li><a href="https://d2.naver.com/helloworld/284659">L4/L7 스위치의 대안, 오픈 소스 로드 밸런서 HAProxy</a></li>
  <li><a href="https://reference-m1.tistory.com/211">배포 전략</a></li>
  <li><a href="https://velog.io/@makeitcloud/%EB%9E%80-L4-load-balancer-vs-L7-load-balancer-%EB%9E%80">L4 load balancer vs L7 load balancer</a></li>
</ul>

<p><br /></p>


  <br />

  <hr />

  <br />
  <script src="https://utteranc.es/client.js"
        repo="hyerin6/hyerin6.github.io"
        issue-term="pathname"
        theme="github-light"
        crossorigin="anonymous"
        async>
  </script>

</div>


    <!-- Documents about icons are here: http://fontawesome.io/icons/ -->
<div class="footer">
  <hr />

  <div class="footer-link">
    
    <a href="https://github.com/hyerin6"><i class="fa fa-github" aria-hidden="true"></i></a>
    
	
    
    <a href="mailto:hyerinn6@gmail.com"><i class="fa fa-envelope" aria-hidden="true"></i></a>
    
  </div>
  © 2022 Hyerin. All rights reserved.
</div>

<br />
<div class="footer">
    <a style="text-align: center;" href="https://hits.seeyoufarm.com">
      <img style="text-align: center;" src="https://hits.seeyoufarm.com/api/count/incr/badge.svg?url=https%3A%2F%2Fhyerin6.github.io&count_bg=%23010101&title_bg=%23070707&icon=&icon_color=%23E7E7E7&title=visitors&edge_flat=false"/>
    </a>
</div>
  </div>
</body>
</html>
