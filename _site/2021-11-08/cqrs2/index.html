<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>CQRS 구현</title>

  <!-- CSS -->
  <link rel="stylesheet" href="/assets/css/main.css" type="text/css">

  <!-- Font -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
  <link href='//spoqa.github.io/spoqa-han-sans/css/SpoqaHanSans-kr.css' rel='stylesheet' type='text/css'>
  <link href="https://fonts.googleapis.com/css?family=Ubuntu+Mono" rel="stylesheet">

  <link rel="alternate" type="application/rss+xml" title="RSS Feed for Hyerin Blog" href="/feed.xml" />
  <!-- Begin Jekyll SEO tag v2.7.1 -->
<title>CQRS 구현 | Hyerin Blog</title>
<meta name="generator" content="Jekyll v3.9.0" />
<meta property="og:title" content="CQRS 구현" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="CQRS(2)" />
<meta property="og:description" content="CQRS(2)" />
<link rel="canonical" href="http://localhost:4000/2021-11-08/cqrs2/" />
<meta property="og:url" content="http://localhost:4000/2021-11-08/cqrs2/" />
<meta property="og:site_name" content="Hyerin Blog" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-11-08T00:00:00+09:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="CQRS 구현" />
<script type="application/ld+json">
{"url":"http://localhost:4000/2021-11-08/cqrs2/","headline":"CQRS 구현","dateModified":"2021-11-08T00:00:00+09:00","datePublished":"2021-11-08T00:00:00+09:00","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/2021-11-08/cqrs2/"},"@type":"BlogPosting","description":"CQRS(2)","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->


  <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-8RJ9ZZ1LSQ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-8RJ9ZZ1LSQ', { 'anonymize_ip': false});
</script>


</head>

<body>
  <div class="content-container">
    <header>
  <div class="header-small">
    <a href="http://localhost:4000">Hyerin Blog</a>
  </div>
</header>
<div class="post">
  <div class="post-title">CQRS 구현</div>
  <br />
  <span class="post-date">
    <time>08 Nov 2021</time>
  </span>

  <div class="post-tag">
    <ul>
      
      <li>
        <a href="http://localhost:4000/tags#CQRS">
          <span>CQRS</span>
        </a>
      </li>
      
      
    </ul>
  </div>

  <p><br /></p>

<h2 id="구현1-같은-프로세스-같은-db">구현1: 같은 프로세스, 같은 DB</h2>
<p><img src="https://user-images.githubusercontent.com/33855307/140700610-bb3f0cee-eeb9-4cd4-b917-2bb4bbe7acda.jpeg" alt="1" /></p>

<p>코드 수준에서만 명령과 쿼리가 분리가 된다.</p>

<p>데이터 수준에서는 분리하지 않는다.</p>

<p>가장 단순하고 명령/쿼리 동일 데이터 보장된다. (트랜잭션 처리 쉬움)</p>

<p><br />
<br /></p>

<h2 id="구현2-같은-프로세스-같은-db-다른-테이블">구현2: 같은 프로세스, 같은 DB, 다른 테이블</h2>

<p><img src="https://user-images.githubusercontent.com/33855307/140701082-dbe99d4c-ab7f-4101-82b4-c0b34e585d53.jpeg" alt="ㅁ" /></p>

<p>명령과 쿼리가 코드, 데이터 수준에서 분리된다.</p>

<p>별도의 테이블을 가지고 구현하기 때문에 같은 DB를 사용한다.</p>

<ul>
  <li>쿼리 전용 테이블 사용
    <ul>
      <li>예) 최근 조회수 많은 글 목록</li>
    </ul>
  </li>
  <li>명령이 쿼리 전용 데이터 변경 유발</li>
</ul>

<p><br />
<br /></p>

<h2 id="구현3--같은-프로세스-다른-db">구현3:  같은 프로세스, 다른 DB</h2>

<p><img src="https://user-images.githubusercontent.com/33855307/140701344-a2e11a3c-5b16-4f1c-98b3-45e76b241166.jpeg" alt="ㅇ" /></p>

<p>상품 목록을 Redis와 같은 저장소에 캐싱하고 쿼리 모델은 Redis를 사용한다.</p>

<p>명령이 데이터를 변경하면 변경 내역을 쿼리 쪽 DB에 전달하게 된다.</p>

<p><br />
<br /></p>

<h2 id="구현4-다른-프로세스-다른-db">구현4: 다른 프로세스, 다른 DB</h2>

<p><img src="https://user-images.githubusercontent.com/33855307/140701729-ca46aae0-fb53-4592-8e9a-17562530e526.jpeg" alt="ㄴ" /></p>

<p>명령이 데이터를 변경하면 변경 내역을 쿼리 쪽 DB에 전달</p>

<p><br /></p>

<h2 id="다른-db로-변경-전파">다른 DB로 변경 전파</h2>

<p><img src="https://user-images.githubusercontent.com/33855307/140702279-11c61d81-205e-469a-af67-d3e86711c06a.jpeg" alt="DB" /></p>

<p>왼쪽부터 방법 1, 2, 3에 해당하는 그림이다.</p>

<p><br /></p>

<h3 id="방법1-명령이-직접-쿼리-디비를-수정하는-방식">방법1) 명령이 직접 쿼리 디비를 수정하는 방식</h3>

<ul>
  <li>
    <p>구현이 단순한게 장점이다.</p>
  </li>
  <li>
    <p>카프카와 같은 메시징 수단을 이용해서 전달하는 변형도 있다.</p>
  </li>
  <li>
    <p>데이터 유실 가능성이 있다.
쿼리 디비나 메시징이 일시적으로 문제가 발생하게 되면 쿼리 디비를 반영해야 할 데이터가 유실될 수 있다.</p>
  </li>
</ul>

<p><br /></p>

<h3 id="방법2-변경-내역을-기록하고-별도의-전파기를-이용해-변경-내용-전달">방법2) 변경 내역을 기록하고 별도의 전파기를 이용해 변경 내용 전달</h3>
<ul>
  <li>
    <p>별도 테이블에 변경 내역 저장 → 한 트랜잭션으로 처리되기 때문에 변경 내역이 유실되지 않음</p>
  </li>
  <li>
    <p>전파기를 따로 구현해야 한다는 부담이 생긴다.</p>
  </li>
  <li>
    <p>이 방법도 중간에 메시징을 두는 변형이 있다.</p>
  </li>
</ul>

<p><br /></p>

<h3 id="방법3-디비가-제공하는-cdc-사용">방법3) 디비가 제공하는 CDC 사용</h3>

<p>디비에 바이너리 로그를 읽어서 변경 데이터를 확인하고</p>

<p>변경된 데이터를 쿼리에 전달하는 방식</p>

<p>두번째 방법과 비슷한데 명령쪽 코드에서 변경 내용을 저장하지 않아도 되기 때문에</p>

<p>명령 코드가 단순해진다는 장점이 있다.</p>

<p>메시징을 중간에 두는 변형이 존재한다.</p>

<p><br /></p>

<h3 id="다른-db-사용시-주의-사항">다른 DB 사용시 주의 사항</h3>
<ul>
  <li>데이터 유실
    <ul>
      <li>유실 허용 여부에 따라 DB 트랜잭션 범위 중요</li>
    </ul>
  </li>
  <li>
    <p>허용 가능 지연 시간</p>
  </li>
  <li>중복 전달</li>
</ul>

<p><br />
<br /></p>

<h3 id="참고">참고</h3>

<ul>
  <li><a href="https://youtu.be/H1IF3BUeFb8">https://youtu.be/H1IF3BUeFb8</a></li>
</ul>

<p><br /></p>


  <br />

  <hr />

  <br />
  <script src="https://utteranc.es/client.js"
        repo="hyerin6/hyerin6.github.io"
        issue-term="pathname"
        theme="github-light"
        crossorigin="anonymous"
        async>
  </script>

</div>


    <!-- Documents about icons are here: http://fontawesome.io/icons/ -->
<div class="footer">
  <hr />

  <div class="footer-link">
    
    <a href="https://github.com/hyerin6"><i class="fa fa-github" aria-hidden="true"></i></a>
    
	
    
    <a href="mailto:hyerinn6@gmail.com"><i class="fa fa-envelope" aria-hidden="true"></i></a>
    
  </div>
  © 2022 Hyerin. All rights reserved.
</div>

<br />
<div class="footer">
    <a style="text-align: center;" href="https://hits.seeyoufarm.com">
      <img style="text-align: center;" src="https://hits.seeyoufarm.com/api/count/incr/badge.svg?url=https%3A%2F%2Fhyerin6.github.io&count_bg=%23010101&title_bg=%23070707&icon=&icon_color=%23E7E7E7&title=visitors&edge_flat=false"/>
    </a>
</div>
  </div>
</body>
</html>
