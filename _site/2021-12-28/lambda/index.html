<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.24.0 by Michael Rose
  Copyright 2013-2020 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <style> 
      ::-webkit-scrollbar{width: 12px; height: 5px;}
      ::-webkit-scrollbar-track {background-color:#4b4f52; border-radius: 16px;}
      ::-webkit-scrollbar-thumb {background-color:#5e6265; border-radius: 16px;}
      ::-webkit-scrollbar-thumb:hover {background: #ffd24c;}
      ::-webkit-scrollbar-button:start:decrement,::-webkit-scrollbar-button:end:increment 
      {
          width:12px;height:12px;background:transparent;
      } 
    </style>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>lambda 와 effectively final - Hyerin Blog</title>
<meta name="description" content="">


  <meta name="author" content="Hyerin Park">
  
  <meta property="article:author" content="Hyerin Park">
  


<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="Hyerin Blog">
<meta property="og:title" content="lambda 와 effectively final">
<meta property="og:url" content="http://localhost:4000/2021-12-28/lambda/">


  <meta property="og:description" content="">







  <meta property="article:published_time" content="2021-12-28T00:00:00+09:00">





  

  


<link rel="canonical" href="http://localhost:4000/2021-12-28/lambda/">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": "Hyerin Park",
      "url": "http://localhost:4000/"
    
  }
</script>







<!-- end _includes/seo.html -->



  <link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Hyerin Blog Feed">


<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css"></noscript>



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- start custom head snippets -->

<link rel="apple-touch-icon" sizes="57x57" href="/assets/favicon.ico/apple-icon-57x57.png">
<link rel="apple-touch-icon" sizes="60x60" href="/assets/favicon.ico/apple-icon-60x60.png">
<link rel="apple-touch-icon" sizes="72x72" href="/assets/favicon.ico/apple-icon-72x72.png">
<link rel="apple-touch-icon" sizes="76x76" href="/assets/favicon.ico/apple-icon-76x76.png">
<link rel="apple-touch-icon" sizes="114x114" href="/assets/favicon.ico/apple-icon-114x114.png">
<link rel="apple-touch-icon" sizes="120x120" href="/assets/favicon.ico/apple-icon-120x120.png">
<link rel="apple-touch-icon" sizes="144x144" href="/assets/favicon.ico/apple-icon-144x144.png">
<link rel="apple-touch-icon" sizes="152x152" href="/assets/favicon.ico/apple-icon-152x152.png">
<link rel="apple-touch-icon" sizes="180x180" href="/assets/favicon.ico/apple-icon-180x180.png">
<link rel="icon" type="image/png" sizes="192x192"  href="/assets/favicon.ico/android-icon-192x192.png">
<link rel="icon" type="image/png" sizes="32x32" href="/assets/favicon.ico/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="96x96" href="/assets/favicon.ico/favicon-96x96.png">
<link rel="icon" type="image/png" sizes="16x16" href="/assets/favicon.ico/favicon-16x16.png">
<link rel="manifest" href="/assets/favicon.ico/manifest.json">
<meta name="msapplication-TileColor" content="#ffffff">
<meta name="msapplication-TileImage" content="/assets/favicon.ico/ms-icon-144x144.png">
<meta name="theme-color" content="#ffffff">

<!-- end custom head snippets -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--single">
    <nav class="skip-links">
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
        <a class="site-title" href="/">
          Hyerin Blog
          
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="/categories/">Category</a>
            </li><li class="masthead__menu-item">
              <a href="/tags/">Tags</a>
            </li><li class="masthead__menu-item">
              <a href="/year-archive/">Year</a>
            </li></ul>
        
        <button class="search__toggle" type="button">
          <span class="visually-hidden">Toggle search</span>
          <i class="fas fa-search"></i>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      



<div id="main" role="main">
  
<div class="sidebar sticky">



<div itemscope itemtype="https://schema.org/Person" class="h-card">

  
    <div class="author__avatar">
      <a href="http://localhost:4000/">
        <img src="/image/profile.png" alt="Hyerin Park" itemprop="image" class="u-photo">
      </a>
    </div>
  

  <div class="author__content">
    <h3 class="author__name p-name" itemprop="name">
      <a class="u-url" rel="me" href="http://localhost:4000/" itemprop="url">Hyerin Park</a>
    </h3>
    
      <div class="author__bio p-note" itemprop="description">
        <p>Backend Developer</p>

      </div>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
        <li itemprop="homeLocation" itemscope itemtype="https://schema.org/Place">
          <i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i> <span itemprop="name" class="p-locality">Republic of Korea</span>
        </li>
      

      
        
          
            <li><a href="mailto:hyerinn6@email.com" rel="nofollow noopener noreferrer me"><i class="fas fa-fw fa-envelope-square" aria-hidden="true"></i><span class="label">Email</span></a></li>
          
        
          
            <li><a href="https://github.com/hyerin6" rel="nofollow noopener noreferrer me"><i class="fab fa-fw fa-github" aria-hidden="true"></i><span class="label">GitHub</span></a></li>
          
        
          
            <li><a href="https://www.instagram.com/___hyerin_/" rel="nofollow noopener noreferrer me"><i class="fab fa-fw fa-instagram" aria-hidden="true"></i><span class="label">Instagram</span></a></li>
          
        
          
            <li><a href="https://blog.naver.com/hyerin_0611" rel="nofollow noopener noreferrer me"><i class="fas fa-fw fa-link" aria-hidden="true"></i><span class="label">Naver Blog</span></a></li>
          
        
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer me">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>




</div>


  <article class="page h-entry" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="lambda 와 effectively final">
    <meta itemprop="description" content="">
    <meta itemprop="datePublished" content="2021-12-28T00:00:00+09:00">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title p-name" itemprop="headline">
            <a href="http://localhost:4000/2021-12-28/lambda/" class="u-url" itemprop="url">lambda 와 effectively final
</a>
          </h1>
          

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          5 minute read
        
      </span>
    
  </p>


        </header>
      

      <section class="page__content e-content" itemprop="text">
        
          <aside class="sidebar__right sticky">
            <nav class="toc">
              <header><h4 class="nav__title"><i class="fas fa-file-alt"></i> On this page</h4></header>
              <ul class="toc__menu"><li><a href="#effectively-final-이란">Effectively final 이란?</a></li><li><a href="#람다에서-사용되는-지역-변수가-final-혹은-effectively-final-이어야-하는-이유">람다에서 사용되는 지역 변수가 final 혹은 effectively final 이어야 하는 이유</a></li><li><a href="#capturing-lambda--non-capturing-lambda">Capturing lambda &amp; Non-Capturing lambda</a><ul><li><a href="#capturing-lambda">Capturing lambda</a></li><li><a href="#non-capturing-lambda">Non-Capturing lambda</a></li><li><a href="#local-capturing-lambda">Local Capturing lambda</a><ul><li><a href="#1-람다식에서-사용되는-외부-지역변수는-복사본이다">1. 람다식에서 사용되는 외부 지역변수는 복사본이다.</a></li><li><a href="#2-final-혹은-effectively-final인-지역-변수만-람다식에서-사용할-수-있다">2. final 혹은 effectively final인 지역 변수만 람다식에서 사용할 수 있다.</a></li><li><a href="#3--복사된-지역-변수-값은-람다식-내부에서도-변경할-수-없다-즉-final-변수로-다뤄야-한다">3.  복사된 지역 변수 값은 람다식 내부에서도 변경할 수 없다. 즉 final 변수로 다뤄야 한다.</a></li></ul></li><li><a href="#non---local-capturing-lambda">Non - local capturing lambda</a></li></ul></li><li><a href="#정리">정리</a></li><li><a href="#참고">참고</a></li></ul></li></ul>

            </nav>
          </aside>
        
        <p><br /></p>

<h1 id="effectively-final-이란">Effectively final 이란?</h1>

<p class="notice--info">A non-final local variable or method parameter whose value is never changed 
after initialization is known as effectively final.</p>

<p>Java 8 에 추가된 syntactic sugar 일종으로, 초기화 된 이후 값이 한번도 변경되지 않았다면 effectively final 이라고 할 수 있다.  <br />
effectively final 변수는 final 키워드가 붙어있지 않았지만 final 키워드를 붙힌 것과 동일하게 컴파일러에서 처리한다.  <br />
<code class="language-plaintext highlighter-rouge">의미상 final 하다</code> 라고 생각하는 사람들이 많다.</p>

<p>java 7 에서는 anonymous class 가 외부지역변수 가 final 인 경우에만 접근이 가능했기에 항상 final 키워드를 추가해줘야 했다.   <br />
java 8 에서는 effectively final 인 경우에도 접근이 가능하게 바뀌어 조건을 만족한다면 final 키워드를 생략할 수 있다.</p>

<p><br /></p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Java 7</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">testPlus</span><span class="o">()</span> <span class="o">{</span>
    <span class="kd">final</span> <span class="kt">int</span> <span class="n">number</span> <span class="o">=</span> <span class="mi">1</span><span class="o">;</span>

    <span class="nc">Addable</span> <span class="n">addableImple</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Addable</span><span class="o">()</span> <span class="o">{</span>
        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">int</span> <span class="nf">plusOne</span><span class="o">()</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">number</span> <span class="o">+</span> <span class="mi">1</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">};</span>
<span class="o">}</span>

<span class="c1">// Java 8</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">testPlus</span><span class="o">()</span> <span class="o">{</span>
    <span class="kt">int</span> <span class="n">number</span> <span class="o">=</span> <span class="mi">1</span><span class="o">;</span> <span class="c1">// Effectively final</span>

    <span class="nc">Addable</span> <span class="n">addableImple</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Addable</span><span class="o">()</span> <span class="o">{</span>
        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">int</span> <span class="nf">plusOne</span><span class="o">()</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">number</span> <span class="o">+</span> <span class="mi">1</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">};</span>
<span class="o">}</span>

<span class="c1">// Java 8</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">testPlus</span><span class="o">()</span> <span class="o">{</span>
    <span class="kt">int</span> <span class="n">number</span> <span class="o">=</span> <span class="mi">1</span><span class="o">;</span> <span class="c1">// Effectively final</span>

    <span class="nc">Addable</span> <span class="n">addableImple</span> <span class="o">=</span> <span class="o">()</span> <span class="o">-&gt;</span> <span class="n">number</span> <span class="o">+</span> <span class="mi">1</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div>

<p><br />
<br /></p>

<h1 id="람다에서-사용되는-지역-변수가-final-혹은-effectively-final-이어야-하는-이유">람다에서 사용되는 지역 변수가 final 혹은 effectively final 이어야 하는 이유</h1>
<p><code class="language-plaintext highlighter-rouge">람다식에서 참조하는 외부 변수는 final 혹은 effectively final이어야 한다.</code>가 100% 맞는 말은 아니다.       <br />
외부 변수는 지역변수, 인스턴스 변수, 클래스 변수가 모두 포함될 수 있는데    <br />
인스턴스 변수나 클래스 변수는 final 혹은 effective final 하지 않아도 람다식에서 사용할 수 있기 때문이다.</p>

<p><br /></p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">private</span> <span class="kt">int</span> <span class="n">instanceNumber</span> <span class="o">=</span> <span class="mi">1</span><span class="o">;</span>
<span class="kd">private</span> <span class="kd">static</span> <span class="kt">int</span> <span class="n">staticNumber</span> <span class="o">=</span> <span class="mi">1</span><span class="o">;</span>    
    
<span class="c1">// Error, 외부 지역변수는 final 혹은 effectively final 이어야 람다식에서 사용할 수 있다.</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">testPlusByLocalVariable</span><span class="o">()</span> <span class="o">{</span>
    <span class="kt">int</span> <span class="n">localNumber</span> <span class="o">=</span> <span class="mi">1</span><span class="o">;</span>

    <span class="n">localNumber</span> <span class="o">=</span> <span class="mi">2</span><span class="o">;</span>
    <span class="nc">Addable</span> <span class="n">addableImple</span> <span class="o">=</span> <span class="o">()</span> <span class="o">-&gt;</span> <span class="n">localNumber</span> <span class="o">+</span> <span class="mi">1</span><span class="o">;</span> 
<span class="o">}</span>
    
<span class="c1">// OK, 값을 변경하더라도 문제 없다.</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">testPlusByInstanceVariable</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">instanceNumber</span> <span class="o">=</span> <span class="mi">2</span><span class="o">;</span>
    <span class="nc">Addable</span> <span class="n">addableImple</span> <span class="o">=</span> <span class="o">()</span> <span class="o">-&gt;</span> <span class="n">instanceNumber</span> <span class="o">+</span> <span class="mi">1</span><span class="o">;</span>
<span class="o">}</span>

<span class="c1">// OK, 값을 변경하더라도 문제 없다.</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">testPlusByStaticVariable</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">staticNumber</span> <span class="o">=</span> <span class="mi">2</span><span class="o">;</span>
    <span class="nc">Addable</span> <span class="n">addableImple</span> <span class="o">=</span> <span class="o">()</span> <span class="o">-&gt;</span> <span class="n">staticNumber</span> <span class="o">+</span> <span class="mi">1</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div>

<p>람다식에서 사용되는 지역 변수가 final 혹은 effective final이어야 하는 이유를 알아보자.</p>

<p><br />
<br /></p>

<h1 id="capturing-lambda--non-capturing-lambda">Capturing lambda &amp; Non-Capturing lambda</h1>
<p>람다식에는 2가지 타입이 존재한다.</p>

<ul>
  <li>Capturing lambda
    <ul>
      <li>Local Capturing lambda</li>
      <li>Non-Local Capturing lambda</li>
    </ul>
  </li>
  <li>Non-Capturing lambda</li>
</ul>

<p><br /></p>

<h3 id="capturing-lambda">Capturing lambda</h3>
<p>외부 변수를 이용하는 람다식을 의미한다. <br />
  외부 변수는 지역변수, 인스턴스 변수, 클래스 변수를 모두 포함한다.</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">String</span> <span class="n">message</span> <span class="o">=</span> <span class="s">"CapturingLambda"</span><span class="o">;</span>
<span class="nc">Runnable</span> <span class="n">runnable</span> <span class="o">=</span> <span class="o">()</span> <span class="o">-&gt;</span> <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">message</span><span class="o">);</span>
</code></pre></div></div>

<p><br /></p>

<h3 id="non-capturing-lambda">Non-Capturing lambda</h3>
<p>외부 변수를 이용하지 않는 람다식을 의미한다.</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">Runnable</span> <span class="n">runnable</span> <span class="o">=</span> <span class="o">()</span> <span class="o">-&gt;</span> <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"NonCapturingLambda"</span><span class="o">);</span>

<span class="nc">Runnable</span> <span class="n">runnable</span> <span class="o">=</span> <span class="o">()</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="nc">String</span> <span class="n">message</span> <span class="o">=</span> <span class="s">"NonCapturingLambda"</span><span class="o">;</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">message</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Capturing lambda는 다시 local capturing lambda와 non-local capturing lambda로 구분할 수 있다.    <br />
local과 non-local을 구분하는 이유는 지역 변수가 가지는 특징으로 인해 내부 동작 방식이 다르기 때문이다.</p>

<p><br /></p>

<h3 id="local-capturing-lambda">Local Capturing lambda</h3>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kt">void</span> <span class="nf">testPlusByLocalVariable</span><span class="o">()</span> <span class="o">{</span>
    <span class="kt">int</span> <span class="n">localNumber</span> <span class="o">=</span> <span class="mi">1</span><span class="o">;</span>
    <span class="nc">Addable</span> <span class="n">addableImple</span> <span class="o">=</span> <span class="o">()</span> <span class="o">-&gt;</span> <span class="n">localNumber</span> <span class="o">+</span> <span class="mi">1</span><span class="o">;</span> 
<span class="o">}</span>
</code></pre></div></div>

<p>외부 변수로 지역 변수를 이용하는 람다식을 의미한다.  <br />
다음과 같은 특징이 있다.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(1) 람다식에서 사용되는 일부 지역 변수는 복사본이다. 
(2) final 혹은 effectively final인 지역 변수만 람다식에서 사용할 수 있다. 
(3) 복사된 지역 변수 값은 람다식 내부에서도 변경할 수 없다. 즉 final 변수로 다뤄야 한다. 
</code></pre></div></div>

<p>위와 같은 특징이 생긴 이유를 알아보자.</p>

<p><br /></p>

<h4 id="1-람다식에서-사용되는-외부-지역변수는-복사본이다">1. 람다식에서 사용되는 외부 지역변수는 복사본이다.</h4>
<p>람다식에서는 외부 지역변수를 그대로 사용하지 못하고 복사본을 사용하는 이유는 다음과 같다.</p>

<ul>
  <li>
    <p>지역 변수는 스택 영역에 생성된다. 따라서 지역 변수가 선언된 block이 끝나면 스택에서 제거된다.  <br />
→ 메소드 내 지역 변수를 참조하는 람다식을 리턴하는 메소드가 있을 경우, 메소드 block이 끝나면  <br />
지역 변수가 스택에서 제거되므로 추후에 람다식이 수행될 때 참조할 수 없다.</p>
  </li>
  <li>
    <p>지역 변수를 관리하는 스레드와 람다식이 실행되는 스레드가 다를 수 있다.  <br />
→ 스택은 각 스레드의 고유의 공간이고, 스레드끼리 공유되지 않기 때문에     <br />
마찬가지로 람다식이 수해오딜 때 값을 참조할 수 없다.</p>
  </li>
</ul>

<p>위와 같은 이유로 인해 람다식에서는 외부 지역 변수를 직접 참조하지 않고 복사본을 전달받아 사용하게 된다.</p>

<p><br /></p>

<h4 id="2-final-혹은-effectively-final인-지역-변수만-람다식에서-사용할-수-있다">2. final 혹은 effectively final인 지역 변수만 람다식에서 사용할 수 있다.</h4>
<p>만약 참조하고자 하는 지역 변수가 final 혹은 effectively final이 아닐 경우 <br />
즉 변경이 가능할 경우 어떤 문제가 발생할까?</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kt">void</span> <span class="nf">executelocalVariableInMultiThread</span><span class="o">()</span> <span class="o">{</span>
    <span class="kt">boolean</span> <span class="n">shouldRun</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
    <span class="n">executor</span><span class="o">.</span><span class="na">execute</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="o">{</span>
        <span class="k">while</span> <span class="o">(</span><span class="n">shouldRun</span><span class="o">)</span> <span class="o">{</span>
            <span class="c1">// do operation</span>
        <span class="o">}</span>
    <span class="o">});</span>
    
    <span class="n">shouldRun</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div>

<p>람다식이 어떤 스레드에서 수행될지는 미리 알 수 없다.   <br />
이 얘기는 곧 외부 지역 변수를 다루는 스레드와 람다식이 수행되는 스레드가 다를 수 있다는 의미이다. <br />
지역 변수 값(<code class="language-plaintext highlighter-rouge">shouldRun</code>)을 제어하는 스레드 A, 람다식이 수행되는 스레드 B가 있다고 가정해보자.</p>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>스레드 B의 shouldRun 값이 가장 최신 값으로 복사되어 전달 됐는지 확신할 수 없다. 
shouldRun은 변경이 가능한 지역 변수이고, 지역 변수를 스레드 간에 sync 해주는 것이 불가능하기 때문이다. 

지역 변수는 스레드 A의 스택 영역에 존재하기 때문에 다른 스레드에서 접근이 불가능하다. 
volatile과 같은 키워드가 로컬 변수에서 사용될 수 없는 이유도 이와 같다. 
</code></pre></div></div>

<p>값이 보장되지 않는다면 매번 다른 결과가 도출될 수 있다.   <br />
이러한 이유로 인해 외부 지역 변수는 전달되는 복사본이 변경되지 않은      <br />
최신 값이라는 것을 보장하기 위해 final 혹은 effectively final이어야 한다.</p>

<p><br /></p>

<h4 id="3--복사된-지역-변수-값은-람다식-내부에서도-변경할-수-없다-즉-final-변수로-다뤄야-한다">3.  복사된 지역 변수 값은 람다식 내부에서도 변경할 수 없다. 즉 final 변수로 다뤄야 한다.</h4>
<p>이미 복사된 값이므로 변경해도 문제가 없는거 아닐까? <strong>아니다.</strong>   <br />
복사될 값의 변조를 막아 최신 값임을 보장하기 위해 final 제약을 걸었는데 람다식 내부에서 변경이 가능할 경우 다시 제자리로 돌아온다.</p>

<p>또한 컴파일 된 람다식은 static 메소드 형태로 변경이 되는데 이때 복사된 값이 파라미터로 전달되므로 <br />
마찬가지로 스택 영역에 존재하기 때문에 sync를 해주는 것도 불가능하다. <br />
따라서 람다식 내부에서도 값이 변경 되어서는 안된다.</p>

<p>컴파일러 레벨에서 앞, 뒤로 final 제약을 걸어줌으로써 멀티 스레드 환경에서 대응하기 어려운 이슈를 미연에 방지한 것이다.</p>

<p><br /></p>

<h3 id="non---local-capturing-lambda">Non - local capturing lambda</h3>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">private</span> <span class="kt">int</span> <span class="n">instanceNumber</span> <span class="o">=</span> <span class="mi">1</span><span class="o">;</span>
<span class="kd">private</span> <span class="kd">static</span> <span class="kt">int</span> <span class="n">staticNumber</span> <span class="o">=</span> <span class="mi">1</span><span class="o">;</span> 

<span class="kd">public</span> <span class="kt">void</span> <span class="nf">testPlusByInstanceVariable</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">instanceNumber</span> <span class="o">=</span> <span class="mi">2</span><span class="o">;</span>
    <span class="nc">Addable</span> <span class="n">addableImple</span> <span class="o">=</span> <span class="o">()</span> <span class="o">-&gt;</span> <span class="n">instanceNumber</span> <span class="o">+</span> <span class="mi">1</span><span class="o">;</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kt">void</span> <span class="nf">testPlusByStaticVariable</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">staticNumber</span> <span class="o">=</span> <span class="mi">2</span><span class="o">;</span>
    <span class="nc">Addable</span> <span class="n">addableImple</span> <span class="o">=</span> <span class="o">()</span> <span class="o">-&gt;</span> <span class="n">staticNumber</span> <span class="o">+</span> <span class="mi">1</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div>

<p>외부 변수로 인스턴스 변수 혹은 클래스 변수를 이용하는 람다식을 의미한다.   <br />
local capturing lambda와 다르게 final 제약 조건이 없고 외부 변수 값도 복사하지 않는다.</p>

<p>이유는 인스턴스 변수나 클래스 변수를 저장하고 있는 메모리 영역은 공통 영역이고  <br />
값이 메모리에서 바로 회수되지 않기 때문에 람다식에서 바로 참조가 가능하다.  <br />
따라서 복사 과정이 불필요하고 참조 시 최신 값 임을 보장할 수 있다. <br />
단, 멀티 스레드 환경일 경우 volatile, synchronized 등을 이용하여 sync를 맞춰주는 작업을 잊어서는 안된다.</p>

<p><br /></p>

<h2 id="정리">정리</h2>
<p>람다식에서 외부 지역 변수를 이용할 경우 final 혹은 effectively final 이어야 하는 이유는 지역 변수가 스택에 저장되기 때문에 람다식에서 값을 바로 참조하는 것에 제약이 있어 복사된 값을 이용하게 되는데, 이때 멀티 쓰레드 환경에서 복사 될/복사된 값이 변경 가능 할 경우 이로 인한 동시성 이슈를 대응할 수 없기 때문이다.</p>

<p><br /></p>

<h2 id="참고">참고</h2>
<ul>
  <li><a href="https://www.baeldung.com/java-effectively-final">https://www.baeldung.com/java-effectively-final</a></li>
  <li><a href="https://www.baeldung.com/java-lambda-effectively-final-local-variables">https://www.baeldung.com/java-lambda-effectively-final-local-variables</a></li>
  <li><a href="https://dzone.com/articles/how-lambdas-and-anonymous-inner-classesaic-work">https://dzone.com/articles/how-lambdas-and-anonymous-inner-classesaic-work</a></li>
</ul>

<p><br /></p>


        
      </section>

      <footer class="page__meta">
        
        
  


  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong>
    <span itemprop="keywords">
    
      <a href="/tags/#java" class="page__taxonomy-item p-category" rel="tag">java</a><span class="sep">, </span>
    
      <a href="/tags/#lambda" class="page__taxonomy-item p-category" rel="tag">lambda</a>
    
    </span>
  </p>




  


  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-folder-open" aria-hidden="true"></i> Categories: </strong>
    <span itemprop="keywords">
    
      <a href="/categories/#java" class="page__taxonomy-item p-category" rel="tag">Java</a>
    
    </span>
  </p>


        

  <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time class="dt-published" datetime="2021-12-28T00:00:00+09:00">December 28, 2021</time></p>

      </footer>

      <section class="page__share">
  

  <a href="https://twitter.com/intent/tweet?text=lambda+%EC%99%80+effectively+final%20http%3A%2F%2Flocalhost%3A4000%2F2021-12-28%2Flambda%2F" class="btn btn--twitter" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Twitter"><i class="fab fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Flocalhost%3A4000%2F2021-12-28%2Flambda%2F" class="btn btn--facebook" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Facebook"><i class="fab fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=http%3A%2F%2Flocalhost%3A4000%2F2021-12-28%2Flambda%2F" class="btn btn--linkedin" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on LinkedIn"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
</section>


      
  <nav class="pagination">
    
      <a href="/2021-12-23/request/" class="pagination--pager" title="HttpMessageNotReadableException 해결하기
">Previous</a>
    
    
      <a href="/2022-01-05/blog/" class="pagination--pager" title="Jekyll - minimal mistakes 사용법
">Next</a>
    
  </nav>

    </div>

    
  </article>

  
  
    <div class="page__related">
      <h2 class="page__related-title">You May Also Enjoy</h2>
      <div class="grid__wrapper">
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/2022-01-05/blog/" rel="permalink">Jekyll - minimal mistakes 사용법
</a>
      
    </h2>
    
      <p class="page__meta"><i class="far fa-fw fa-calendar-alt" aria-hidden="true"></i> January 05 2022</p>
    
    <p class="archive__item-excerpt" itemprop="description">

</p>
  </article>
</div>
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/2021-12-23/request/" rel="permalink">HttpMessageNotReadableException 해결하기
</a>
      
    </h2>
    
      <p class="page__meta"><i class="far fa-fw fa-calendar-alt" aria-hidden="true"></i> December 23 2021</p>
    
    <p class="archive__item-excerpt" itemprop="description">

</p>
  </article>
</div>
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/2021-12-19/sort/" rel="permalink">Sort
</a>
      
    </h2>
    
      <p class="page__meta"><i class="far fa-fw fa-calendar-alt" aria-hidden="true"></i> December 19 2021</p>
    
    <p class="archive__item-excerpt" itemprop="description">

</p>
  </article>
</div>
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/2021-12-17/dp/" rel="permalink">Dynamic Programming
</a>
      
    </h2>
    
      <p class="page__meta"><i class="far fa-fw fa-calendar-alt" aria-hidden="true"></i> December 17 2021</p>
    
    <p class="archive__item-excerpt" itemprop="description">

</p>
  </article>
</div>
        
      </div>
    </div>
  
  
</div>
    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap"><form class="search-content__form" onkeydown="return event.key != 'Enter';" role="search">
    <label class="sr-only" for="search">
      Enter your search term...
    </label>
    <input type="search" id="search" class="search-input" tabindex="-1" placeholder="Enter your search term..." />
  </form>
  <div id="results" class="results"></div></div>

      </div>
    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    

    
      
        
          <li><a href="mailto:hyerinn6@email.com" rel="nofollow noopener noreferrer"><i class="fas fa-fw fa-envelope-square" aria-hidden="true"></i> Email</a></li>
        
      
        
          <li><a href="https://github.com/hyerin6" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
        
      
        
          <li><a href="https://www.instagram.com/___hyerin_/" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-instagram" aria-hidden="true"></i> Instagram</a></li>
        
      
        
          <li><a href="https://blog.naver.com/hyerin_0611" rel="nofollow noopener noreferrer"><i class="fas fa-fw fa-link" aria-hidden="true"></i> Naver Blog</a></li>
        
      
    

    
      <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
    
  </ul>
</div>


<div class="page__footer-copyright">&copy; 2022 Hyerin Park. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>




<script src="/assets/js/lunr/lunr.min.js"></script>
<script src="/assets/js/lunr/lunr-store.js"></script>
<script src="/assets/js/lunr/lunr-en.js"></script>




    <script>
  'use strict';

  (function() {
    var commentContainer = document.querySelector('#utterances-comments');

    if (!commentContainer) {
      return;
    }

    var script = document.createElement('script');
    script.setAttribute('src', 'https://utteranc.es/client.js');
    script.setAttribute('repo', 'hyerin6/hyerin6.github.io');
    script.setAttribute('issue-term', 'pathname');
    
    script.setAttribute('theme', 'github-light');
    script.setAttribute('crossorigin', 'anonymous');

    commentContainer.appendChild(script);
  })();
</script>

  





  </body>
</html>
