---
layout: post
title: "객체 생성과 파괴"
description: "effective java"
date: 2021-05-24
tags: [effective-java, java]
comments: true
share: true
---

# 아이템 1. 생성자 대신 정적 팩토리 메서드를 고려하라               
클래스의 인스턴스를 얻는 전통적인 수단은 public 생성자이다.    
클래스는 생성자와 별도로 static factory method를 제공하며 다음과 같은 장단점이 있다.    

### 장점   
1. 이름을 가질 수 있다.    
<br />       
   
2. 호출될 때마다 인스턴스를 새로 생성하지 않아도 된다.      
ex.`Boolean.valueOf(boolean)`               
불변 클래스는 미리 인스턴스를 만들거나 새로 생성한 인스턴스를 캐싱해 재활용할 수 있으므로 메모리 측면에서 유리하다.               
이렇게 언제 어느 인스턴스를 살아있게 할지를 철저히 통제할 수 있다. 이를 **인스턴스 통제 클래스**라고 한다. <br />          
인스턴스를 통제하면 다음과 같이 만들 수 있다.                 
* 싱글톤   
* 인스턴스화 불가   
* 불변 값 클래스에서 동치 인스턴스가 하나뿐임을 보장 (`a==b` 일 때만 `a.equals(b)`가 성립)     
<br />       
  
3. 하위 타입 객체를 반환할 수 있다.           
* java 8: 인터페이스에는 public 정적 멤버만 허용        
* java 9: private 정적 메서드까지 허용하지만 정적 필드와 정적 멤버 클래스는 public이어야 한다.              
<br />          

4. 입력 매개변수에 따라 매번 다른 클래스의 객체를 반환할 수 있다.        
반환 타입의 하위 타입이기만 하면 어떤 클래스의 객체를 반환하든 상관없다.     
<br />       
   
5. 정적 팩토리 메서드를 작성하는 시점에 반환할 객체의 클래스가 존재하지 않아도 된다.            
이러한 유연함은 Service Provider 프레임워크의 근간이 된다. 대표적인 예로 JDBC가 있다.     
* `DriverManager.registerDriver()` 메서드로 각 DBMS별 Driver를 설정한다. (제공자 등록 API)  
* `DriverManager.getConnection()` 메서드로 DB 커넥션 객체를 받는다. (service access API)  
* `Connection Interface`는 DBMS 별로 동작을 구현하여 사용할 수 있다. (service Interface)  

위에서 설명한 3개의 핵심 컴포넌트와 더불어 종종 **서비스 제공자 인터페이스**라는 네 번째 컴포넌트가 쓰이기도 한다.   
이는 서비스 인터페이스의 인스턴스를 생성하는 팩토리 객체를 설명해준다.    
서비스 제공자 인터페이스가 없다면 각 구현체를 인스턴스로 만들 때 **리플렉션**을 사용해야 한다.         

<br />       

### 단점    
1. 상속을 하려면 public이거나 protected 생성자가 필요하므로 정적 팩토리 메서드만 제공하면 하위 클래스를 만들 수 없다.              
컬렉션 프레임 워크의 유틸리티 구현 클래스는 private 생성자만 제공하므로 상속이 불가하다.           
이러한 제약은 상속보다 컴포지션을 사용하도록 유도되어 오히려 더 장점으로 작용한다.             
<br />            

2. 정적 팩토리 메서드는 프로그래머가 찾기 어렵다.           
흔히 사용하는 명명 방식을 지켜보자.   

<br />     


정적 팩터리 메서드는 각각의 쓰임새가 있으니, 장단점을 잘 인식하고 무작정 public 생성자만 사용하는 습관을 고쳐보자.  



