---
layout: post
title: "AWS S3, BULK INSERT"  
description: "depromeet final 5 : 프로필 이미지를 저장해보자."
date: 2020-11-26
tags: [depromeet]
comments: true
share: true
--- 


# AWS S3 : 프로필 이미지 저장     

### - 설계   

사용자가 kakao, naver로 회원가입을 하지만 따로 프로필 이미지를 지정하고 싶은 경우     
이미지 파일을 받는다. 반려견은 3장의 이미지 파일을 등록할 수 있다.     
3장의 이미지 파일은 우선순위가 있다는 것이 주의할 점이다. 

그래서 이미지와 사용자, 반려견의 연관관계에 대해 고민이 많았는데       
나중에 서비스에 sns 기능을 추가할 생각이 있기 때문에     
다음 두가지 방법 중 2번째 방법으로 구현하기로 했다.     


**방법1 : Image 테이블에 모든 정보 넣기**    

![스크린샷 2020-11-26 오후 2 30 45](https://user-images.githubusercontent.com/33855307/100311808-08bc0e80-2ff4-11eb-8c6e-edd7f3b560e6.png)    

<br /> 

**방법2 : 우선순위, 카테고리 별로 테이블 따로 두기**      

![스크린샷 2020-11-30 오후 11 49 47](https://user-images.githubusercontent.com/33855307/100624431-d0576000-3366-11eb-9b4c-5f7c74aac4f1.png)   

<br />       



### - aws s3 bulk upload         

그동안 AWS S3를 2번 정도 사용해봤는데 여러 이미지를 저장해야 하는 경우가 없어서     
`putObject()` 메소드만 사용해서 하나의 `MultipartFile`만 저장했었다.     

이번에는 반려동물의 프로필 이미지 3개를 한번에 저장해야 했기 때문에     
이미지 리스트를 한번에 저장할 수 있는 기능이 있는지 찾아봤다.       

`TransferManager`를 사용하여 `List<File>`을 한번에 넘겨주니     
랜덤 문자열로 지정한 폴더와 이미지가 잘 저장된다.     

참고 : <https://docs.aws.amazon.com/ko_kr/AmazonS3/latest/dev/HLuploadFileJava.html>         


<br />       

# BULK INSERT            
  
참고 : <https://www.mssqltips.com/sqlservertip/3434/options-to-improve-sql-server-bulk-load-performance/>  

