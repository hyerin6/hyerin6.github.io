---
layout: post
title: "자바 성능 튜닝 이야기 (3)"  
description: "story(10) - (16)"
date: 2020-06-07
tags: [java]
comments: true
share: true
---

## story 10. 로그는 반드시 필요한 내용만 찍자.    

어떤 로거를 사용하든 모두 성능상 이슈가 발생할 수 있다.   

#### - System.out.println() 의 문제점   

System.out.println() 메서드를 사용한 시스템 로그는       
편하지만 성능에 영향을 많이 주는 경우가 빈번히 발생한다.   

파일이나 콘솔에 로그를 남길 경우를 생각해보자. 내용이 완전히 프린트되거나 저장될 때까지,   
뒤에 프린트하려는 부분은 대기할 수 밖에 없다.   
특히 콘솔에 로그를 남길 경우에는 더더욱 그렇다.   
그렇게 되면 애플리케이션에서는 대기 시간이 발생한다.   

이 대기 시간은 시스템의 속도에 의존적이다.   
만약 디스크에 로그를 남긴다면, 서버 디스트의 RPM이 높을수록 로그의 처리 속도는 빨라질 것이다.   


## story 11. JSP와 서블릿, Spring에서 발생할 수 있는 여러 문제점     

#### - JSP와 Servlet의 기본적인 동작 원리는 꼭 알아야 한다.   

일반적으로 JSP와 같은 웹 화면단을 처리하는 부분에서 소요되는 시간은 많지 않다.     
JSP의 경우 가장 처음에 호출되는 경우에만 시간이 소요되고, 그 이후의 시간에는 컴파일된 서블릿 클래스가 수행되기 때문이다.     
그럼 JSP의 라이프 사이클을 간단하게 리뷰해보자.    

1. JSP URL 호출   
2. 페이지 번역   
3. JSP 페이지 컴파일   
4. 클래스 로드   
5. 인스턴스 생성   
6. jspInit 메서드 호출   
7. _jspService 메서드 호출   
8. jspDestory 메서드 호출   

여기서 해당 JSP 페이지가 이미 컴파일되어 있고, 클래스가 로드되어 있고, JSP 파일이 변경되지 않았다면,     
가장 많은 시간이 소요되는 2 ~ 4 프로세스는 생략된다.   

이번에는 서블릿의 라이프 사이클을 살펴보자.   

- Servlet 객체가 자동으로 생성되고 초기화 되거나,     
- 사용자가 해당 Servlet을 처음으로 호출했을 때 생성되고 초기화 된다.     

그 다음에는 계속 '사용 가능' 상태로 대기한다.         


**서블릿은 JVM에 여러 객체로 생성되지 않는다.** 는 점을 기억해야 한다.   

다시 말해서 WAS가 시작하고, '사용 가능' 상태가 된 이상 대부분의 서블릿은 JVM에 살아 있고,    
여러 스레드에서 해당 서블릿의 service() 메서드를 호출하여 공유한다.      



#### - 자바 빈즈, 잘 쓰면 약 못 쓰면 독  
  
자바 빈즈(Java Beans)는 UI에서 서버 측 데이터를 담아서 처리하기 위한 컴포넌트이다.      
간단하게 자바 빈즈의 문제점을 알아보자.   

자바 빈즈를 통해 useBean을 하면 성능에 많은 영향을 미치지는 않지만, 너무 많이 사용하면 JSP에서 소요되는 시간이 증가될 수 있다.   

한두 개의 자바 빈즈를 사용하는 것은 상관 없지만, 10~20개의 자바 빈즈를 사용하면 성능에 영향을 주게 된다.   
그래서 TO를 만들어서 사용하도록 하자.   


#### - 스프링 프레임워크 간단 정리   

스프링 프레임워크는 데스크톱과 웹 어플리케이션, 작고 간단한 애플리케이션부터            
여러 서버와 연동하여 동작해야 하는 엔터프라이즈 애플리케이션도 범용적인 애플리케이션 프레임워크이다.           

Spring의 가장 큰 특징은 복잡한 애플리케이션도 POJO(Plain Old Java Object)로 개발할 수 있다는 점이다.   
서블릿을 개발하려면 반드시 HttpServlet이라는 클래스를 상속해야 한다.   
하지만 스프링을 사용하면 HttpServlet을 확장하지 않아도 웹 요청을 처리할 수 있는 클래스를 만들 수 있다.   


#### - 스프링의 핵심 기술   

Dependency Injection, Aspect Oriented Programming, Portable Service Abstraction 으로 함축할 수 있다.    

(1) Dependency Injection     
'의존성 주입' 이라고 한다.    
객체간의 관계를 관리하는 기술로 생각하면 된다.     
어떤 객체가 필요로 하는 객체를 자기 자신이 직접 생성하여 사용하는 것이 아니라    
외부에 있는 다른 무언가로부터 필요로 하는 객체를 주입 받는 기술이다.        

(2) AOP (Aspect Oriented Programming)    
'관점 지향 프로그래밍' 이라고 부른다.   
대부분은 비슷한 코드가 중복되고 코드를 읽는 데 방해가 된다.   
이런 코드를 실제 비즈니스 로직과 분리할 수 있도록 도와주는 것이 바로 AOP이다.   

자바에서 가장 유명한 AOP 프레임워크로는 AspectJ가 있다.   

(3) PSA (Portable Service Abstraction)    
스프링은 비슷한 기술을 모두 아우를 수 있는 추상화 계층을 제공하여, 사용하는 기술이 바뀌더라도   
비즈니스 로직의 변화가 없도록 도와준다.   


#### - 스프링 프레임워크를 사용하면서 발생할 수 있는 문제점들     

스프링 프레임워크를 사용할 때 성능 문제가 가장 많이 발생하는 부분은 '프록시(proxy)'와 관련이 있다.   
스프링 프록시는 기본적으로 실행 시에 생성된다.   
따라서 요청량이 많은 운영 상황으로 넘어가면 문제가 나타날 수 있다.   

스프링이 프록시를 사용하게 하는 주요 기능은 트랜잭션이다.   
@Transaction 어노테이션을 사용하면 해당 어노테이션을 사용한 클래스의 인스턴스를 처음 만들 때 프록시 객체를 만든다.   
개발자가 직접 스프링 AOP를 사용해서 별도의 기능을 추가하는 경우에도 프록시를 사용하는데,   
이 부분에서 문제가 많이 발생한다.   

따라서, 간단한 부하 툴을 사용해서라도 성능적인 면을 테스트해야만 한다.   

추가로, 스프링이 내부 매커니즘에서 사용하는 캐시도 조심해야 한다.   

