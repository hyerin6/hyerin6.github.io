---
layout: post
title: "Jenkins CI/CD"
description: "테스트하기 전에 배포를 먼저 해보자!"
date: 2021-10-20
tags: [infra]
comments: true
share: true
---
<br />

지금 진행중인 [SNS 프로젝트](https://github.com/hyerin6/SNS) 에 Cacahe를 적용하기 전에

캐시 적용 전, 후 부하 테스트 결과의 차이를 확인하기 위해서

배포를 위해 Jenkins로 CI/CD 부터 자동화 시켜보자.

<br />

Jenkins 관련 포스팅

* [Docker로 Jenkins 사용하기](https://hyerin6.github.io/2020-04-21/0421/)
* [Jenkins 배포 자동화 스크립트](https://hyerin6.github.io/2020-11-21/jenkins-cd/)
* [Jenkins 테스트 자동화 스크립트](https://hyerin6.github.io/2020-10-21/jenkins-ci/)
* [자동 배포 마무리](https://hyerin6.github.io/2020-04-24/0424/)

<br />
<br />

# CI/CD란?

[RedHat](https://www.redhat.com/ko/topics/devops/what-is-ci-cd) 에서 정의한 CI/CD의 개념은 애플리케이션 개발 단계를 자동화하여 애플리케이션을 보다 짧은 주기로 고객에게 제공하는 방법이다.

이렇게만 들으면 왜 CI/CD 자동화를 구축해야 하는지 와닿지 않는다.

애플리케이션의 규모가 크다고 가정하자.

그럼 단순히 개발하고 테스트, 빌드, 배포를 하는데만 시간이 꽤 걸릴 것이다.

또한 한 사람이 관리하는 게 아니라 몇십명으로 구성된 팀이 관리할 것이기 때문에

이 애플리케이션의 수정본을 하나로 합치는 것부터 배포까지 시간이 오래 걸려 긴 배포 주기를 갖게 될 것이다.

시간이 오래 걸리면 사용자의 피드백을 빠르게 반영할 수 없고 배포 과정 속에서 문제가 발생할 가능성도 높다.

<br />

이런 문제점을 개선하기 위해 CI/CD를 적용해야 한다.

애플리케이션 코드 병합부터 테스트, 배포까지 라이프사이클 전체에 걸쳐

자동화시켜 더 짧은 주기로 고객들에게 애플리케이션을 제공할 수 있어야 한다.

<br />

따라서 CI/CD는 지속적인 통합(Continuous Integration),

지속적인 서비스 제공(Continuous Delivery), 지속적인 배포(Continuous Deployment)로 구성되어 있다.

<br />

#### 지속적인 통합

지속적인 통합, CI(Continuous Integration)란 자동화된 빌드 및 테스트가 수행된 후,

개발자가 코드 변경 사항을 중앙 리포지토리에 정기적으로 병합하는 DevOps 소프트웨어 개발 방식이다.

버전 관리를 통한 코드 병합, 빌드, 테스트, 오류 보고를 자동화하여 반복적인 작업을 줄이고,

발생한 문제에 대해 빠르게 처리가 가능하여 더 좋은 품질의 소프트웨어를 개발할 수 있다.

<br />

#### 지속적인 서비스 제공

지속적인 서비스 제공, CD(Continuous Delivery)는 반복적인 작업을 자동화한 CI 과정을 거친 소스코드를 레포지토리에 자동으로 반영하는 단계를 의미한다.

바로 프로덕션 단계로 배포하는 지속적인 배포 단계로 확장이 가능하지만, 따로 테스트 환경에 배포하여 추가적인 여러 사용자 차원에서 테스트를 검증할 수 있다.

<br />

#### 지속적인 배포

지속적인 배포, CD(Continuous Deployment)는 CI/CD의 마지막 단계로 모든 테스트를 거친 코드를 레포지토리에 자동으로 반영하는 지속적인 서비스 제공 단계의 확장된 형태이다.

애플리케이션을 프로덕션 단계로 자동으로 배포하는 작업을 자동화하여, 개발자가 변경 사항을 적용한 후 짧은 시간 이내에 사용자는 새로운 버전의 애플리케이션을 사용할 수 있다.

<br />
<br />

# CI/CD 프로세스 속에서의 애플리케이션 배포 과정

![ㅋ](https://user-images.githubusercontent.com/33855307/138029194-9eb77ce3-1c83-49a0-b46a-e8a282a74e7d.jpeg)

1. 개발자는 소스 코드를 수정하고, 코드 컨벤션을 준수했는지,
   코드가 잘 작동하는지 Pull Request를 보내 자동으로 확인합니다.
2. 변경된 소스 코드에 대해 코드 리뷰를 진행한다.
3. 코드 리뷰가 끝나면 PR Merge 작업이 수행된다.
4. 배포 가능한 소스 코드를 주기적으로 빌드하여 테스트 버전을 생성한 후, 여러 테스트를 진행한다.
5. 테스트 과정에서 발생한 오류를 수정하여 스토어에 배포한다.

<br />

위와 같은 작업을 자동화하여 배포 주기 단축 및 불편함을 최소화하는 것이 CI/CD 구축 목적이다.

<br />
<br />

# Jenkins 설치 & 기본 설정 
Jenkins는 CI/CD 자동화를 제공하는 툴이다. 

다양한 플로그인과 문서를 지원하기 때문에 나도 프로젝트에서 항상 사용해왔다. 

<br />

설치 방법이 어려운건 아닌데 최신 버전이 아니면 플러그인이 정상적으로 설치되지 않는다. 

클라우드에서 제공하는 Jenkins 서버는 최신 버전이 설치되지 않는 경우가 많으니 

직접 설치하는게 좋을 것 같다. 

<br />

```shell
$ sudo yum install wget
$ sudo yum install maven
$ sudo yum install git

$ sudo wget -O /etc/yum.repos.d/jenkins.repo https://pkg.jenkins.io/redhat-stable/jenkins.repo
$ sudo rpm --import https://pkg.jenkins.io/redhat-stable/jenkins.io.key
$ sudo yum install jenkins
$ sudo systemctl start jenkins
$ sudo systemctl status jenkins
```

<br />

위와 같은 명령어로 Jenkins를 설치하고 시작할 수 있다.

이 외에 주의할 점은 java, gradle 버전 체크이다.

당연히 동일해야 하므로 확인해보는 것이 좋다. 

<br />

![스크린샷 2021-10-20 오후 2 23 41](https://user-images.githubusercontent.com/33855307/138067726-3d024db4-aa77-41b5-9553-19fb78ed6b9d.png)
![스크린샷 2021-10-20 오후 2 23 32](https://user-images.githubusercontent.com/33855307/138067732-1844e27a-cc33-4abb-a0b9-6b1f556d0eab.png)

<br />
<br />


### 참고 
* <https://www.redhat.com/ko/topics/devops/what-is-ci-cd>
* <https://engineering.linecorp.com/ko/blog/build-a-continuous-cicd-environment-based-on-data/>

<br />
